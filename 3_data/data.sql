-- 

-- Ваш SQL код здесь

-- ============================================
-- 1. Клиенты (5 клиентов)
-- ============================================
INSERT INTO clients (first_name, last_name, middle_name, birth_date, passport_series, passport_number, passport_issued_by, passport_issue_date, phone, email) VALUES
('Иван', 'Иванов', 'Иванович', '1985-03-15', '4512', '567890', 'ОУФМС России по Московской области', '2005-04-20', '+79001234567', 'ivan.ivanov@example.com'),
('Мария', 'Петрова', 'Сергеевна', '1990-07-22', '4513', '098765', 'ОУФМС России по г. Санкт-Петербургу', '2010-08-15', '+79001112233', 'maria.petrova@example.com'),
('Алексей', 'Сидоров', 'Петрович', '1978-11-30', '4514', '123456', 'ОУФМС России по Свердловской области', '1998-12-10', '+79005556677', NULL),
('Елена', 'Смирнова', 'Александровна', '1995-05-10', '4515', '654321', 'ОУФМС России по Краснодарскому краю', '2015-06-25', '+79007778899', 'elena.smirnova@example.com'),
('Дмитрий', 'Кузнецов', 'Михайлович', '1982-09-18', '4516', '111222', 'ОУФМС России по Республике Татарстан', '2002-10-30', '+79003334455', 'dmitry.kuznetsov@example.com');

-- ============================================
-- 2. История процентных ставок (5 записей)
-- ============================================
-- Ставки для срочных вкладов (product_type_id = 1)
INSERT INTO interest_rate_history (product_type_id, rate_percent, effective_from, effective_to) VALUES
(1, 7.00, '2024-01-01', '2024-03-31'),  -- rate_history_id = 1
(1, 7.50, '2024-04-01', '2024-06-30'),  -- rate_history_id = 2
(1, 8.00, '2024-07-01', NULL);          -- rate_history_id = 3 (текущая)

-- Ставки для накопительных счетов (product_type_id = 2)
INSERT INTO interest_rate_history (product_type_id, rate_percent, effective_from, effective_to) VALUES
(2, 5.00, '2024-01-01', '2024-05-31'),  -- rate_history_id = 4
(2, 5.50, '2024-06-01', NULL);          -- rate_history_id = 5 (текущая)

-- ============================================
-- 3. Банковские счета (8 счетов)
-- ============================================
-- status_id: 1 = open, 2 = closed, 3 = blocked

-- Счета клиента 1 (Иван Иванов): вклад и накопительный
INSERT INTO accounts (client_id, product_type_id, status_id, initial_rate_id, account_number, currency, current_balance, current_rate, opened_date, deposit_term_months) VALUES
(1, 1, 1, 3, '40817810000000000001', 'RUB', 510000.00, 8.00, '2024-07-01', 12),        -- Срочный вклад
(1, 2, 1, 5, '40817810000000000002', 'RUB', 160650.00, 5.50, '2024-06-15', NULL);      -- Накопительный

-- Счета клиента 2 (Мария Петрова): накопительный и вклад
INSERT INTO accounts (client_id, product_type_id, status_id, initial_rate_id, account_number, currency, current_balance, current_rate, opened_date, deposit_term_months) VALUES
(2, 2, 1, 5, '40817810000000000003', 'RUB', 251900.00, 5.50, '2024-08-01', NULL),      -- Накопительный
(2, 1, 1, 3, '40817810000000000004', 'RUB', 765000.00, 8.00, '2024-07-15', 24);        -- Срочный вклад

-- Счет клиента 3 (Алексей Сидоров): накопительный
INSERT INTO accounts (client_id, product_type_id, status_id, initial_rate_id, account_number, currency, current_balance, current_rate, opened_date, deposit_term_months) VALUES
(3, 2, 1, 4, '40817810000000000005', 'RUB', 40590.00, 5.50, '2024-03-10', NULL);       -- Накопительный

-- Счета клиента 4 (Елена Смирнова): два вклада (один закрыт)
INSERT INTO accounts (client_id, product_type_id, status_id, initial_rate_id, account_number, currency, current_balance, current_rate, opened_date, deposit_term_months) VALUES
(4, 1, 1, 2, '40817810000000000006', 'RUB', 1037850.00, 7.50, '2024-04-20', 12),       -- Срочный вклад (активный)
(4, 1, 2, 1, '40817810000000000007', 'RUB', 0.00, 7.00, '2024-01-15', 6);              -- Срочный вклад (ЗАКРЫТ)

-- Счет клиента 5 (Дмитрий Кузнецов): накопительный в USD
INSERT INTO accounts (client_id, product_type_id, status_id, initial_rate_id, account_number, currency, current_balance, current_rate, opened_date, deposit_term_months) VALUES
(5, 2, 1, 5, '40817840000000000008', 'USD', 5022.92, 5.50, '2024-09-01', NULL);        -- Накопительный USD

-- ============================================
-- 4. Операции по счетам (27 операций)
-- ============================================
-- operation_type_id: 1 = deposit, 2 = withdraw, 3 = interest_accrual

-- Операции по счету 1 (Вклад Ивана Иванова)
INSERT INTO operations (account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(1, 1, '2024-07-01 10:00:00', 500000.00, 500000.00, 'Открытие срочного вклада'),
(1, 3, '2024-10-01 00:00:00', 10000.00, 510000.00, 'Начисление процентов за 3 месяца');

-- Операции по счету 2 (Накопительный Ивана Иванова)
INSERT INTO operations (account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(2, 1, '2024-06-15 11:00:00', 100000.00, 100000.00, 'Открытие накопительного счёта'),
(2, 1, '2024-07-10 14:30:00', 50000.00, 150000.00, 'Пополнение счёта'),
(2, 2, '2024-08-20 16:45:00', 20000.00, 130000.00, 'Снятие средств'),
(2, 1, '2024-09-15 09:20:00', 30000.00, 160000.00, 'Пополнение счёта'),
(2, 3, '2024-10-01 00:00:00', 650.00, 160650.00, 'Начисление процентов за месяц');

-- Операции по счету 3 (Накопительный Марии Петровой)
INSERT INTO operations (account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(3, 1, '2024-08-01 10:30:00', 200000.00, 200000.00, 'Открытие накопительного счёта'),
(3, 1, '2024-08-25 15:00:00', 100000.00, 300000.00, 'Крупное пополнение'),
(3, 3, '2024-09-01 00:00:00', 800.00, 300800.00, 'Начисление процентов за август'),
(3, 2, '2024-09-10 12:00:00', 50000.00, 250800.00, 'Частичное снятие'),
(3, 3, '2024-10-01 00:00:00', 1100.00, 251900.00, 'Начисление процентов за сентябрь');

-- Операции по счету 4 (Вклад Марии Петровой)
INSERT INTO operations (account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(4, 1, '2024-07-15 13:00:00', 750000.00, 750000.00, 'Открытие срочного вклада на 2 года'),
(4, 3, '2024-10-15 00:00:00', 15000.00, 765000.00, 'Начисление процентов за квартал');

-- Операции по счету 5 (Накопительный Алексея Сидорова)
INSERT INTO operations (account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(5, 1, '2024-03-10 11:00:00', 50000.00, 50000.00, 'Открытие накопительного счёта'),
(5, 3, '2024-04-01 00:00:00', 200.00, 50200.00, 'Начисление процентов'),
(5, 3, '2024-05-01 00:00:00', 210.00, 50410.00, 'Начисление процентов'),
(5, 2, '2024-06-05 14:00:00', 10000.00, 40410.00, 'Снятие средств'),
(5, 3, '2024-07-01 00:00:00', 180.00, 40590.00, 'Начисление процентов');

-- Операции по счету 6 (Вклад Елены Смирновой)
INSERT INTO operations (account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(6, 1, '2024-04-20 10:00:00', 1000000.00, 1000000.00, 'Открытие крупного вклада'),
(6, 3, '2024-07-20 00:00:00', 18750.00, 1018750.00, 'Начисление процентов за квартал'),
(6, 3, '2024-10-20 00:00:00', 19100.00, 1037850.00, 'Начисление процентов за квартал');

-- Операции по счету 7 (Закрытый вклад Елены Смирновой)
INSERT INTO operations (account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(7, 1, '2024-01-15 10:00:00', 500000.00, 500000.00, 'Открытие вклада'),
(7, 3, '2024-04-15 00:00:00', 8750.00, 508750.00, 'Начисление процентов'),
(7, 2, '2024-07-15 15:00:00', 508750.00, 0.00, 'Закрытие вклада с выплатой');

-- Операции по счету 8 (Накопительный USD Дмитрия Кузнецова)
INSERT INTO operations (account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(8, 1, '2024-09-01 10:00:00', 5000.00, 5000.00, 'Открытие валютного счёта'),
(8, 3, '2024-10-01 00:00:00', 22.92, 5022.92, 'Начисление процентов в USD');

-- ============================================
-- 5. Операции 2025 года для проверки блокировки
-- ============================================

-- Вклад клиента 1 (превысит 1 млн за месяц)
INSERT INTO operations(account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(1, 1, '2025-10-05 12:40', 600000, 1110000, 'Пополнение перед блокировкой'),
(1, 1, '2025-10-14 19:30', 500000, 1610000, 'Крупное пополнение');

-- Накопительный клиент 1 (тоже превысит лимит)
INSERT INTO operations(account_id, operation_type_id, operation_date, amount, balance_after, description) VALUES
(2, 1, '2025-10-03 09:10', 700000, 860650, 'Пополнение крупным объёмом');

-- ============================================
-- Итоговая статистика
-- ============================================

DO $$
BEGIN
    RAISE NOTICE '========================================';
    RAISE NOTICE 'Тестовые данные успешно загружены!';
    RAISE NOTICE '========================================';
    RAISE NOTICE 'Клиентов: 5';
    RAISE NOTICE 'Счетов: 8 (7 открытых, 1 закрытый)';
    RAISE NOTICE 'Записей истории ставок: 5';
    RAISE NOTICE 'Операций: 27';
    RAISE NOTICE '========================================';
END $$;